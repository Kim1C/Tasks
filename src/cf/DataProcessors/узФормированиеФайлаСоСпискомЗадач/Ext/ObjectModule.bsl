
Процедура СформироватьФайл() Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	узЗадачи.Код КАК НомерЗадачи,
	|	узЗадачи.Наименование КАК Наименование,
	|	узЗадачи.Исполнитель.узКороткоеИмя КАК ИсполнительузКороткоеИмя,
	|	узЗадачи.ОсновнаяЗадача КАК ОсновнаяЗадача
	|ИЗ
	|	Справочник.узЗадачи КАК узЗадачи
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерЗадачи";
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Если РезультатЗапроса.Пустой() Тогда
		Возврат;
	Конецесли;
	
	Выборка = РезультатЗапроса.Выбрать();
	
	ИмяФайла = ПапкаДляВыгрузки + "\ListTasks.txt"; 
	ФайлСЗадачами = Новый ЗаписьТекста(ИмяФайла, КодировкаТекста.UTF8); 	
	Пока Выборка.Следующий() Цикл
		
		пНаименование = СокрЛП(Выборка.Наименование);
		пНаименование = СтрЗаменить(пНаименование, "#","№");
		
		пТекстЗадачи = "#"+Формат(Выборка.НомерЗадачи,"ЧГ=0");
		пТекстЗадачи = пТекстЗадачи + " " + пНаименование;
		
		Если ЗначениеЗаполнено(Выборка.ИсполнительузКороткоеИмя) Тогда
			пТекстЗадачи = пТекстЗадачи + " | " + СокрЛП(Выборка.ИсполнительузКороткоеИмя);
		Конецесли;
		Если ЗначениеЗаполнено(Выборка.ОсновнаяЗадача) Тогда
			пТекстЗадачи = пТекстЗадачи + " | " + СокрЛП(Выборка.ОсновнаяЗадача);
		Конецесли;
		
		ФайлСЗадачами.ЗаписатьСтроку(пТекстЗадачи); 	
	КонецЦикла;
	
	ФайлСЗадачами.Закрыть(); 
	Сообщить("Сформирован файл - " + ИмяФайла);
КонецПроцедуры 